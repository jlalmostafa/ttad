<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="theme-color" content="#6a11cb">
    <link rel="manifest" href="data:application/manifest+json,{
        &quot;name&quot;: &quot;ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·Ù„Ø¨Ø§Øª&quot;,
        &quot;short_name&quot;: &quot;Ø·Ù„Ø¨Ø§Øª&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;#f5f7fa&quot;,
        &quot;theme_color&quot;: &quot;#6a11cb&quot;,
        &quot;icons&quot;: [{
            &quot;src&quot;: &quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%236a11cb'/%3E%3Ctext x='50' y='70' font-size='70' text-anchor='middle' fill='white' font-family='Arial'%3EğŸ“¦%3C/text%3E%3C/svg%3E&quot;,
            &quot;sizes&quot;: &quot;192x192&quot;,
            &quot;type&quot;: &quot;image/svg+xml&quot;
        }]
    }">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Ù†Ø³Ø®Ø© PWA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            padding: 0;
            margin: 0;
            font-size: 16px;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .header p {
                font-size: 1rem;
            }
            .nav-btn {
                padding: 0.7rem 1.2rem;
                font-size: 1rem;
            }
            .container {
                padding: 0 1rem;
            }
            .content-section {
                padding: 1.5rem;
            }
            .section-title {
                font-size: 1.6rem;
            }
            .form-group input,
            .form-group textarea,
            .form-group select {
                padding: 0.9rem;
                font-size: 1rem;
            }
            .btn-primary, .btn-secondary, .btn-success, .btn-danger, .btn-admin {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
            .orders-grid {
                grid-template-columns: 1fr;
            }
            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }
            .filter-bar select {
                min-width: auto;
            }
            .location-status {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            #map {
                height: 350px;
            }
            .modal-content {
                padding: 1.5rem;
                width: 98%;
            }
        }
        
        /* Ø´Ø§Ø´Ø§Øª Ù…ØªÙˆØ³Ø·Ø© */
        @media (min-width: 601px) and (max-width: 1024px) {
            body {
                font-size: 15px;
            }
            .container {
                padding: 0 1.5rem;
            }
            .orders-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 1.8rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .header h1 {
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.3rem;
        }
        
        /* Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø®ØµØµ */
        #installBtn {
            background: white;
            color: #6a11cb;
            border: none;
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: bold;
            margin-right: 1rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        #installBtn:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }
        #installBtn i {
            font-size: 1.2rem;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding: 1.5rem;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            border-bottom: 3px solid #6a11cb;
        }
        
        .nav-btn {
            background: #f0f2f5;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #555;
            font-weight: 600;
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            box-shadow: 0 4px 10px rgba(106, 17, 203, 0.3);
        }
        
        .nav-btn i {
            font-size: 1.3rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .content-section {
            display: none;
            background: white;
            border-radius: 25px;
            padding: 2.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 1rem;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 2.2rem;
            margin-bottom: 2rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 3px solid #f0f2f5;
            padding-bottom: 1.2rem;
        }
        
        .section-title i {
            color: #6a11cb;
            font-size: 2.2rem;
        }
        
        .form-group {
            margin-bottom: 1.8rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.8rem;
            color: #444;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 1.2rem;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.1rem;
            transition: all 0.3s;
            background: #fafafa;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 4px rgba(106, 17, 203, 0.1);
            background: white;
        }
        
        .btn-primary,
        .btn-secondary,
        .btn-success,
        .btn-danger,
        .btn-admin {
            border: none;
            padding: 1.2rem 2.5rem;
            border-radius: 15px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.3);
        }
        
        .btn-secondary {
            background: #f0f2f5;
            color: #555;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #eb3349, #f45c43);
            color: white;
        }
        
        .btn-admin {
            background: linear-gradient(135deg, #8e2de2, #4a00e0);
            color: white;
        }
        
        .btn-primary:hover,
        .btn-secondary:hover,
        .btn-success:hover,
        .btn-danger:hover,
        .btn-admin:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        #map {
            height: 550px;
            width: 100%;
            border-radius: 25px;
            margin-bottom: 1.8rem;
            border: 3px solid white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1;
        }
        
        .location-status {
            background: #f8f9fa;
            padding: 1.2rem 2rem;
            border-radius: 20px;
            margin: 2rem 0;
            display: flex;
            align-items: center;
            gap: 20px;
            color: #555;
            border: 1px solid #e0e0e0;
            font-size: 1.2rem;
        }
        
        .location-status i {
            color: #2575fc;
            font-size: 1.6rem;
        }
        
        .filter-bar {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 20px;
        }
        
        .filter-bar select {
            flex: 2;
            min-width: 300px;
            padding: 1.2rem;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.2rem;
            background: white;
        }
        
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .order-item {
            background: white;
            border-radius: 22px;
            padding: 1.8rem;
            border-right: 8px solid #6a11cb;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0;
        }
        
        .order-item:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 30px rgba(106, 17, 203, 0.1);
        }
        
        .order-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        
        .order-item-service {
            font-weight: 800;
            color: #333;
            font-size: 1.3rem;
        }
        
        .order-item-status {
            font-size: 1rem;
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
            font-weight: 700;
        }
        
        .status-new {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .status-taken {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-cancelled {
            background: #fee2e2;
            color: #b91c1c;
        }
        
        .order-item-details {
            color: #555;
            font-size: 1.1rem;
            margin: 1rem 0;
            line-height: 1.6;
        }
        
        .order-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.2rem;
            font-size: 1.1rem;
            color: #666;
        }
        
        .order-item-actions {
            display: flex;
            gap: 1rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 30px;
            max-width: 700px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2.5rem;
            position: relative;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }
        
        .modal-close {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            background: none;
            border: none;
            font-size: 2.5rem;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }
        
        .modal-close:hover {
            color: #f00;
        }
        
        .service-checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 20px;
        }
        
        .service-checkbox {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem;
            background: white;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            font-size: 1.1rem;
        }
        
        .channels-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .channels-table th,
        .channels-table td {
            border: 1px solid #e0e0e0;
            padding: 1.2rem;
            text-align: right;
            font-size: 1.1rem;
        }
        
        .channels-table th {
            background: linear-gradient(135deg, #f0f2f5, #e9ecef);
            font-weight: 800;
        }
        
        .channel-link {
            background: #25D366;
            color: white;
            padding: 0.7rem 1.5rem;
            border-radius: 40px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            transition: background 0.2s;
        }
        
        .channel-link:hover {
            background: #128C7E;
        }
        
        .admin-panel {
            background: linear-gradient(135deg, #f3e5f5, #ede7f6);
            padding: 2rem;
            border-radius: 22px;
            margin-bottom: 2.5rem;
            border: 1px solid #d1c4e9;
        }
        
        .footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 1.1rem;
            background: white;
            margin-top: 2.5rem;
            border-top: 1px solid #e0e0e0;
        }
        
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }
        
        .loading-box {
            background: white;
            padding: 2.5rem;
            border-radius: 40px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: pulse 1.5s infinite;
        }
        
        .loading-box i {
            font-size: 4rem;
            color: #6a11cb;
            margin-bottom: 1.2rem;
        }
        
        .loading-box p {
            font-size: 1.5rem;
            color: #333;
            font-weight: 700;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-tasks"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·Ù„Ø¨Ø§Øª <button id="installBtn" style="display: none;"><i class="fas fa-download"></i> ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button></h1>
        <p>Ù…Ù†ØµØ© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª - Ù†Ø³Ø®Ø© PWA Ù…ØªÙƒØ§Ù…Ù„Ø©</p>
    </div>
    
    <div class="nav">
        <button class="nav-btn active" id="homeBtn"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button class="nav-btn" id="customerBtn"><i class="fas fa-user"></i> Ø§Ù„Ø²Ø¨ÙˆÙ†</button>
        <button class="nav-btn" id="providerBtn"><i class="fas fa-truck"></i> Ù…Ù‚Ø¯Ù… Ø§Ù„Ø®Ø¯Ù…Ø©</button>
        <button class="nav-btn btn-admin" id="adminBtn"><i class="fas fa-crown"></i> Ø§Ù„Ø£Ø¯Ù…Ù†</button>
    </div>
    
    <div class="container">
        <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="homeSection" class="content-section active">
            <h2 class="section-title"><i class="fas fa-map-marked-alt"></i> Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©</h2>
            <div id="map"></div>
            
            <div class="location-status" id="locationStatus">
                <i class="fas fa-map-pin"></i>
                <span>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</span>
                <button id="locateMeBtn" class="btn-secondary" style="margin-right: auto; padding: 0.8rem 2rem;">
                    <i class="fas fa-crosshairs"></i> ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ÙŠ
                </button>
            </div>
            
            <div class="filter-bar">
                <select id="serviceFilter">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</option>
                    <option value="taxi">ØªÙƒØ³ÙŠ</option>
                    <option value="delivery">ØªÙˆØµÙŠÙ„ Ø·Ù„Ø¨Ø§Øª</option>
                    <option value="food">ØªÙˆØµÙŠÙ„ ÙˆØ¬Ø¨Ø§Øª</option>
                    <option value="vegetables">ØªÙˆØµÙŠÙ„ Ø®Ø¶Ø±ÙˆØ§Øª</option>
                    <option value="rental">Ø¥ÙŠØ¬Ø§Ø±Ø§Øª Ù†Ù‚Ù„</option>
                    <option value="goods">Ù†Ù‚Ù„ Ø¨Ø¶Ø§Ø¦Ø¹</option>
                    <option value="repair">ØªØµÙ„ÙŠØ­ / ØµÙŠØ§Ù†Ø©</option>
                    <option value="electrician">ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option>
                    <option value="appliance">Ø¥ØµÙ„Ø§Ø­ Ø£Ø¯ÙˆØ§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</option>
                    <option value="store">Ù…Ø­Ù„ Ø£Ø¯ÙˆØ§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</option>
                    <option value="restaurant">Ù…Ø·Ø§Ø¹Ù…</option>
                </select>
                <button class="btn-primary" id="newOrderBtn"><i class="fas fa-plus"></i> Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
            </div>
            
            <h3 style="margin: 2.5rem 0 1.2rem; font-size: 1.8rem;"><i class="fas fa-location-arrow"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© (Ø¶Ù…Ù† 2 ÙƒÙ…)</h3>
            <div id="nearbyOrders" class="orders-grid"></div>
            
            <h3 style="margin: 2.5rem 0 1.2rem; font-size: 1.8rem;"><i class="fas fa-lightbulb"></i> Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ø®Ø¯Ù…Ø§Øª Ø£Ø®Ø±Ù‰ Ù‚Ø±ÙŠØ¨Ø©</h3>
            <div id="suggestedOrders" class="orders-grid"></div>
        </div>
        
        <!-- Ù‚Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† -->
        <div id="customerSection" class="content-section">
            <h2 class="section-title"><i class="fas fa-user-circle"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†</h2>
            <form id="customerForm">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… <span style="color: red;">*</span></label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ <span style="color: red;">*</span></label>
                    <input type="tel" id="customerPhone" required placeholder="+963*********" 
                           pattern="\+963[0-9]{9,}" title="ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø±Ù‚Ù… Ø¨Ù€ +963 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 13 Ø±Ù‚Ù… (Ù…Ø«Ø§Ù„: +963912345678)">
                </div>
                <button type="submit" class="btn-primary"><i class="fas fa-save"></i> Ø­ÙØ¸</button>
            </form>
            
            <h3 style="margin: 2.5rem 0 1.5rem; font-size: 1.8rem;">Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
            <div id="myOrdersList" class="orders-grid"></div>
        </div>
        
        <!-- Ù‚Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø®Ø¯Ù…Ø© -->
        <div id="providerSection" class="content-section">
            <h2 class="section-title"><i class="fas fa-id-card"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù‚Ø¯Ù… Ø§Ù„Ø®Ø¯Ù…Ø©</h2>
            <form id="providerForm">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… <span style="color: red;">*</span></label>
                    <input type="text" id="providerName" required>
                </div>
                
                <div class="form-group">
                    <label>Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªÙ‚Ø¯Ù…Ù‡Ø§ <span style="color: red;">*</span></label>
                    <div class="service-checkbox-group">
                        <label class="service-checkbox"><input type="checkbox" name="services" value="taxi"> ØªÙƒØ³ÙŠ</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="delivery"> ØªÙˆØµÙŠÙ„ Ø·Ù„Ø¨Ø§Øª</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="food"> ØªÙˆØµÙŠÙ„ ÙˆØ¬Ø¨Ø§Øª</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="vegetables"> ØªÙˆØµÙŠÙ„ Ø®Ø¶Ø±ÙˆØ§Øª</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="rental"> Ø¥ÙŠØ¬Ø§Ø±Ø§Øª Ù†Ù‚Ù„</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="goods"> Ù†Ù‚Ù„ Ø¨Ø¶Ø§Ø¦Ø¹</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="repair"> ØªØµÙ„ÙŠØ­ / ØµÙŠØ§Ù†Ø©</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="electrician"> ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="appliance"> Ø¥ØµÙ„Ø§Ø­ Ø£Ø¯ÙˆØ§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="store"> Ù…Ø­Ù„ Ø£Ø¯ÙˆØ§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</label>
                        <label class="service-checkbox"><input type="checkbox" name="services" value="restaurant"> Ù…Ø·Ø§Ø¹Ù…</label>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </form>
            
            <div id="providerChannelsContainer" style="margin-top: 2.5rem; display: none;">
                <h3 style="font-size: 1.8rem;"><i class="fas fa-link"></i> Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªÙ‚Ø¯Ù…Ù‡Ø§</h3>
                <p style="font-size: 1.2rem;">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</p>
                <table class="channels-table" id="providerChannelsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                            <th>Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©</th>
                            <th>Ø§Ù†Ø¶Ù…Ø§Ù…</th>
                        </tr>
                    </thead>
                    <tbody id="providerChannelsBody"></tbody>
                </table>
            </div>
            
            <h3 style="margin: 2.5rem 0 1.5rem; font-size: 1.8rem;">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø£Ø®ÙˆØ°Ø©</h3>
            <div id="takenOrdersList"></div>
        </div>
        
        <!-- Ù‚Ø³Ù… Ø§Ù„Ø£Ø¯Ù…Ù† -->
        <div id="adminSection" class="content-section">
            <h2 class="section-title"><i class="fas fa-crown"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
            
            <div id="adminLogin" class="admin-panel">
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                    <input type="password" id="adminPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
                </div>
                <button id="adminLoginBtn" class="btn-admin"><i class="fas fa-lock-open"></i> Ø¯Ø®ÙˆÙ„</button>
            </div>
            
            <div id="adminContent" style="display: none;">
                <h3 style="font-size: 1.8rem;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª ÙˆØ§Ù„Ù‚Ù†ÙˆØ§Øª</h3>
                
                <div class="form-group">
                    <label>ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¹Ø§Ù… (ÙŠØ³ØªØ®Ø¯Ù… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ù†ÙˆØ§Øª)</label>
                    <input type="text" id="adminBotToken" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
                </div>
                
                <p style="font-size: 1.2rem;">Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ù†Ø§Ø© Ù„ÙƒÙ„ Ø®Ø¯Ù…Ø© (Ù…Ø«Ù„ @username Ø£Ùˆ -100...). ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¨ÙˆØª Ù…Ø¶Ø§ÙØ§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø© ÙƒÙ…Ø´Ø±Ù.</p>
                
                <table class="channels-table" id="adminChannelsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                            <th>Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ù†Ø§Ø© (Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª)</th>
                            <th>Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… (Ù„Ù…Ù‚Ø¯Ù… Ø§Ù„Ø®Ø¯Ù…Ø©)</th>
                        </tr>
                    </thead>
                    <tbody id="adminChannelsBody"></tbody>
                </table>
                
                <button id="saveChannelsBtn" class="btn-success"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ -->
    <div id="newOrderModal" class="modal">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <h2 style="font-size: 2rem;"><i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
            <form id="newOrderForm">
                <div class="form-group">
                    <label>Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                    <select id="orderService" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©</option>
                        <option value="taxi">ØªÙƒØ³ÙŠ</option>
                        <option value="delivery">ØªÙˆØµÙŠÙ„ Ø·Ù„Ø¨Ø§Øª</option>
                        <option value="food">ØªÙˆØµÙŠÙ„ ÙˆØ¬Ø¨Ø§Øª</option>
                        <option value="vegetables">ØªÙˆØµÙŠÙ„ Ø®Ø¶Ø±ÙˆØ§Øª</option>
                        <option value="rental">Ø¥ÙŠØ¬Ø§Ø±Ø§Øª Ù†Ù‚Ù„</option>
                        <option value="goods">Ù†Ù‚Ù„ Ø¨Ø¶Ø§Ø¦Ø¹</option>
                        <option value="repair">ØªØµÙ„ÙŠØ­ / ØµÙŠØ§Ù†Ø©</option>
                        <option value="electrician">ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option>
                        <option value="appliance">Ø¥ØµÙ„Ø§Ø­ Ø£Ø¯ÙˆØ§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</option>
                        <option value="store">Ù…Ø­Ù„ Ø£Ø¯ÙˆØ§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</option>
                        <option value="restaurant">Ù…Ø·Ø§Ø¹Ù…</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</label>
                    <textarea id="orderDetails" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                    <div id="orderLocationInfo">
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...</p>
                        <button type="button" id="pickLocationBtn" class="btn-secondary">
                            <i class="fas fa-map-pin"></i> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹
                        </button>
                    </div>
                </div>
                <div style="display: flex; gap: 1.5rem; justify-content: flex-end;">
                    <button type="submit" class="btn-primary">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                    <button type="button" class="btn-secondary" onclick="app.closeModals()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
    <div id="locationPickerModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <button class="modal-close">&times;</button>
            <h2 style="font-size: 2rem;"><i class="fas fa-map-marker-alt"></i> Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
            <div id="locationMap" style="height: 550px; margin: 1.5rem 0; border-radius: 22px; border: 2px solid #ddd;"></div>
            <div style="display: flex; gap: 1.5rem; justify-content: center; flex-wrap: wrap;">
                <button id="useCurrentLocationBtn" class="btn-secondary">
                    <i class="fas fa-location-arrow"></i> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
                </button>
                <button id="confirmLocationBtn" class="btn-primary">
                    <i class="fas fa-check"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                </button>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <h2 style="font-size: 2rem;"><i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
            <div id="orderDetailsContent" style="font-size: 1.2rem;"></div>
        </div>
    </div>
    
    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loadingOverlay">
        <div class="loading-box">
            <i class="fas fa-spinner fa-spin"></i>
            <p id="loadingMessage">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>
    
    <div class="footer">
        <h3> ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… :00963949340870</h3>
        <h3 style="color:red;">Ø´ÙƒØ§ÙˆÙŠ:00963949340870</h3>
        <p>ØªØµÙ…ÙŠÙ…: Ø¬Ù„Ø§Ù„ Ø§Ù„Ù…ØµØ·ÙÙ‰ </p>
        <p id="appStatus" style="font-size: 1.1rem; color: #888;">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ù‡Ø²</p>
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2025</p>
    </div>
    
    <script>
        // ================== Service Worker Registration ==================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful');
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // Install button logic (PWA)
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'inline-flex';
        });

        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to the install prompt: ${outcome}`);
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            installBtn.style.display = 'none';
        });

        // ================== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ==================
        const API_BASE_URL = 'https://script.google.com/macros/s/AKfycbwgPe-dUI3wh599QmvcQZGcXllE9z6g1qMnTZ6QirjUZ6Wkxk9TdounFFqiwRZjZPY3dw/exec'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·
        const ADMIN_PASSWORD = '009911';
        
        class TalabatApp {
            constructor() {
                this.config = {
                    API_BASE_URL: API_BASE_URL,
                    MAP_CENTER: [35.9312, 36.6336],
                    MAP_ZOOM: 12,
                    UPDATE_INTERVAL: 30000,
                    ORDER_TIMEOUT: 15 * 60 * 1000,
                    TAKEN_TIMEOUT: 60 * 1000,
                    NEARBY_DISTANCE: 2, // ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† 1 Ø¥Ù„Ù‰ 2 ÙƒÙ…
                };
                
                this.state = {
                    user: null,
                    provider: null,
                    orders: [],
                    channels: {},
                    botToken: '',
                    map: null,
                    locationPickerMap: null,
                    markers: {},
                    locationMarker: null,
                    currentPosition: null,
                    selectedLocation: null,
                    selectedOrderLocation: null,
                    updateTimer: null,
                    lastFilter: 'all',
                    takenOrders: [],
                    newOrdersCheck: [],
                    isFirstLoad: true,
                    adminLoggedIn: false
                };
                
                this.serviceIcons = {
                    taxi: 'fas fa-taxi',
                    delivery: 'fas fa-truck',
                    food: 'fas fa-utensils',
                    vegetables: 'fas fa-carrot',
                    rental: 'fas fa-truck-moving',
                    goods: 'fas fa-boxes',
                    repair: 'fas fa-wrench',
                    electrician: 'fas fa-bolt',
                    appliance: 'fas fa-tv',
                    store: 'fas fa-store',
                    restaurant: 'fas fa-hotel',
                };
                
                this.serviceNames = {
                    taxi: 'ØªÙƒØ³ÙŠ',
                    delivery: 'ØªÙˆØµÙŠÙ„ Ø·Ù„Ø¨Ø§Øª',
                    food: 'ØªÙˆØµÙŠÙ„ ÙˆØ¬Ø¨Ø§Øª',
                    vegetables: 'ØªÙˆØµÙŠÙ„ Ø®Ø¶Ø±ÙˆØ§Øª',
                    rental: 'Ø¥ÙŠØ¬Ø§Ø±Ø§Øª Ù†Ù‚Ù„',
                    goods: 'Ù†Ù‚Ù„ Ø¨Ø¶Ø§Ø¦Ø¹',
                    repair: 'ØªØµÙ„ÙŠØ­ / ØµÙŠØ§Ù†Ø©',
                    electrician: 'ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ',
                    appliance: 'Ø¥ØµÙ„Ø§Ø­ Ø£Ø¯ÙˆØ§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',
                    store: 'Ù…Ø­Ù„ Ø£Ø¯ÙˆØ§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',
                    restaurant: 'Ù…Ø·Ø§Ø¹Ù…',
                };
                
                this.init();
            }
            
            // =============== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ===============
            showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
                document.getElementById('loadingMessage').innerText = message;
                document.getElementById('loadingOverlay').style.display = 'flex';
            }
            
            hideLoading() {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
            
            async init() {
                this.loadUserData();
                this.setupEventListeners();
                this.initMap();
                await this.loadChannelsAndBotToken();
                await this.loadOrdersFromSheet();
                this.state.isFirstLoad = false;
                this.startAutoUpdate();
                this.updateLocationStatus();
                this.updateAppStatus('Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„');
                this.loadFilterPreference();
                this.showUnakenOrdersOnMap();
            }
            
            setupEventListeners() {
                document.getElementById('homeBtn').addEventListener('click', () => this.showSection('home'));
                document.getElementById('customerBtn').addEventListener('click', () => this.showSection('customer'));
                document.getElementById('providerBtn').addEventListener('click', () => this.showSection('provider'));
                document.getElementById('adminBtn').addEventListener('click', () => this.showSection('admin'));
                
                document.getElementById('customerForm').addEventListener('submit', (e) => this.saveCustomer(e));
                document.getElementById('providerForm').addEventListener('submit', (e) => this.saveProvider(e));
                document.getElementById('newOrderForm').addEventListener('submit', (e) => this.createOrder(e));
                document.getElementById('newOrderBtn').addEventListener('click', () => this.showNewOrderModal());
                document.getElementById('locateMeBtn').addEventListener('click', () => this.locateUser());
                document.getElementById('pickLocationBtn').addEventListener('click', () => this.showLocationPicker());
                document.getElementById('confirmLocationBtn').addEventListener('click', () => this.confirmLocation());
                document.getElementById('useCurrentLocationBtn').addEventListener('click', () => this.useCurrentLocationForPicker());
                document.getElementById('serviceFilter').addEventListener('change', (e) => {
                    this.filterOrders(e.target.value);
                    this.saveFilterPreference();
                });
                
                document.querySelectorAll('input[name="services"]').forEach(cb => {
                    cb.addEventListener('change', () => this.displayProviderChannels());
                });
                
                document.getElementById('adminLoginBtn').addEventListener('click', () => this.adminLogin());
                document.getElementById('saveChannelsBtn').addEventListener('click', () => this.saveChannels());
                
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', () => this.closeModals());
                });
                window.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        this.closeModals();
                    }
                });
            }
            
            displayProviderChannels() {
                const selectedServices = [];
                document.querySelectorAll('input[name="services"]:checked').forEach(cb => {
                    selectedServices.push(cb.value);
                });
                
                const container = document.getElementById('providerChannelsContainer');
                const tbody = document.getElementById('providerChannelsBody');
                
                if (selectedServices.length === 0 || Object.keys(this.state.channels).length === 0) {
                    container.style.display = 'none';
                    return;
                }
                
                let html = '';
                selectedServices.forEach(service => {
                    const channel = this.state.channels[service];
                    if (channel && channel.inviteLink) {
                        html += `
                            <tr>
                                <td><i class="${this.serviceIcons[service]}"></i> ${this.serviceNames[service]}</td>
                                <td><a href="${channel.inviteLink}" target="_blank" class="channel-link"><i class="fab fa-telegram"></i> Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©</a></td>
                                <td><a href="${channel.inviteLink}" target="_blank" class="btn-success" style="padding: 0.7rem 1.5rem; font-size: 1.1rem; text-decoration: none;">Ø§Ù†Ø¶Ù…Ø§Ù…</a></td>
                            </tr>
                        `;
                    }
                });
                
                if (html) {
                    tbody.innerHTML = html;
                    container.style.display = 'block';
                } else {
                    container.style.display = 'none';
                }
            }
            
            displayAdminChannels() {
                const tbody = document.getElementById('adminChannelsBody');
                let html = '';
                Object.keys(this.serviceNames).forEach(service => {
                    const channel = this.state.channels[service] || { username: '', inviteLink: '' };
                    html += `
                        <tr>
                            <td><i class="${this.serviceIcons[service]}"></i> ${this.serviceNames[service]}</td>
                            <td><input type="text" id="username_${service}" class="form-control" value="${channel.username || ''}" placeholder="@username" style="width: 100%; padding: 0.9rem; border-radius: 12px; border: 1px solid #ddd; font-size: 1.1rem;"></td>
                            <td><input type="text" id="link_${service}" class="form-control" value="${channel.inviteLink || ''}" placeholder="https://t.me/joinchat/..." style="width: 100%; padding: 0.9rem; border-radius: 12px; border: 1px solid #ddd; font-size: 1.1rem;"></td>
                        </tr>
                    `;
                });
                tbody.innerHTML = html;
                document.getElementById('adminBotToken').value = this.state.botToken || '';
            }
            
            adminLogin() {
                const pwd = document.getElementById('adminPassword').value;
                if (pwd === ADMIN_PASSWORD) {
                    this.state.adminLoggedIn = true;
                    document.getElementById('adminLogin').style.display = 'none';
                    document.getElementById('adminContent').style.display = 'block';
                    this.loadChannelsAndBotToken().then(() => {
                        this.displayAdminChannels();
                    });
                    this.showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    this.showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©', 'error');
                }
            }
            
            async saveChannels() {
                const channels = {};
                Object.keys(this.serviceNames).forEach(service => {
                    const username = document.getElementById(`username_${service}`).value.trim();
                    const inviteLink = document.getElementById(`link_${service}`).value.trim();
                    channels[service] = { username, inviteLink };
                });
                
                const botToken = document.getElementById('adminBotToken').value.trim();
                
                this.showLoading('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
                try {
                    await this.callAppsScript('saveChannels', {
                        channels: JSON.stringify(channels),
                        botToken: botToken
                    });
                    this.state.channels = channels;
                    this.state.botToken = botToken;
                    this.hideLoading();
                    this.showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    this.displayProviderChannels();
                } catch (error) {
                    this.hideLoading();
                    this.showAlert('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + error.message, 'error');
                }
            }
            
            async callAppsScript(action, data = {}) {
                const url = this.config.API_BASE_URL;
                const formData = new URLSearchParams();
                formData.append('action', action);
                for (let key in data) {
                    if (data.hasOwnProperty(key)) {
                        formData.append(key, data[key]);
                    }
                }
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData
                    });
                    if (!response.ok) throw new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                    const result = await response.json();
                    if (result.error) throw new Error(result.error);
                    return result;
                } catch (error) {
                    console.error('API call error:', error);
                    throw error;
                }
            }
            
            async loadChannelsAndBotToken() {
                try {
                    const result = await this.callAppsScript('getChannels');
                    this.state.channels = result.channels || {};
                    this.state.botToken = result.botToken || '';
                } catch (error) {
                    console.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª:', error);
                    this.state.channels = {};
                    this.state.botToken = '';
                }
            }
            
            async loadOrdersFromSheet() {
                try {
                    const result = await this.callAppsScript('getOrders');
                    this.state.orders = result.orders || [];
                    this.state.orders = this.state.orders.map(o => {
                        o.hidden = o.hidden === true || o.hidden === 'true';
                        return o;
                    });
                    this.cleanOldOrders();
                    this.state.takenOrders = this.state.orders.filter(o => o.status === 'taken' && o.takenBy === this.state.provider?.id);
                    this.saveToStorage('orders', this.state.orders);
                    this.saveToStorage('takenOrders', this.state.takenOrders);
                    this.updateDisplay();
                } catch (error) {
                    console.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
                    this.state.orders = this.getFromStorage('orders') || [];
                    this.state.takenOrders = this.getFromStorage('takenOrders') || [];
                } finally {
                    this.hideLoading();
                }
            }
            
            async saveOrdersToSheet() {
                try {
                    await this.callAppsScript('saveOrders', { orders: JSON.stringify(this.state.orders) });
                } catch (error) {
                    console.error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
                }
                this.saveToStorage('orders', this.state.orders);
                this.saveToStorage('takenOrders', this.state.takenOrders);
            }
            
            async sendBotNotifications(order) {
                if (this.state.isFirstLoad) return;
                if (!this.state.botToken) {
                    console.log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙƒÙ† Ø¨ÙˆØª Ø¹Ø§Ù… Ù…Ø¶Ø¨ÙˆØ·');
                    return;
                }
                
                const channel = this.state.channels[order.service];
                if (!channel || !channel.username) {
                    console.log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù‚Ù†Ø§Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø©:', order.service);
                    return;
                }
                
                const success = await this.sendTelegramMessage(this.state.botToken, channel.username, order);
                if (!success) {
                    this.showAlert(`ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù‚Ù†Ø§Ø© (${this.serviceNames[order.service]}) - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† ÙˆÙ…Ø¹Ø±Ù Ø§Ù„Ù‚Ù†Ø§Ø©`, 'warning');
                }
            }
            
            async sendTelegramMessage(token, chatId, order) {
                try {
                    if (!chatId || chatId.trim() === '') {
                        console.error('Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ÙØ§Ø±Øº');
                        return false;
                    }
                    
                    const distance = this.calculateDistance(
                        this.config.MAP_CENTER[0], this.config.MAP_CENTER[1],
                        order.location.lat, order.location.lng
                    ).toFixed(1);
                    
                    let message = `
â™» *Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”§ *Ø§Ù„Ø®Ø¯Ù…Ø©:* ${this.serviceNames[order.service]}
ğŸ“*Ø§Ù„ØªÙØ§ØµÙŠÙ„:* ${order.details}
---------------------------------------------------
ğŸ“ *Ø§Ù„Ù…ÙˆÙ‚Ø¹:* ${order.location.address}
ğŸ“ *Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ù…Ø±ÙƒØ² Ø¥Ø¯Ù„Ø¨:* ${distance} ÙƒÙ…
ğŸ“ *Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:* ${order.phone}
ğŸ‘¤ *Ø§Ù„Ø²Ø¨ÙˆÙ†:* ${order.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
ğŸ—ºï¸ *Ø§Ù„Ø®Ø±ÙŠØ·Ø©:* https://maps.google.com/?q=${order.location.lat},${order.location.lng}
ğŸ“± *Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:* https://wa.me/${order.phone}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”

                    `;
                    
                    const url = `https://api.telegram.org/bot${token}/sendMessage`;
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: chatId,
                            text: message,
                            parse_mode: 'Markdown',
                            reply_markup: {
                                inline_keyboard: [
                                    [
                                        { text: 'ğŸ“ ÙˆØ§ØªØ³Ø§Ø¨', url: `https://wa.me/${order.phone}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹%20${order.customerName}` },
                                        { text: 'ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©', url: `https://maps.google.com/?q=${order.location.lat},${order.location.lng}` }
                                    ]
                                ]
                            }
                        })
                    });
                    
                    const result = await response.json();
                    if (!result.ok) {
                        console.error('Ø®Ø·Ø£ ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', result);
                        if (result.error_code === 400 && result.description.includes('chat not found')) {
                            this.showAlert(`Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ù†Ø§Ø© ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ø§Ù„Ø¨ÙˆØª Ù„ÙŠØ³ Ø¹Ø¶ÙˆØ§Ù‹ (${chatId})`, 'error');
                        } else if (result.error_code === 401) {
                            this.showAlert('ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                        }
                        return false;
                    }
                    return true;
                } catch (error) {
                    console.error('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', error);
                    return false;
                }
            }
            
            initMap() {
                this.state.map = L.map('map').setView(this.config.MAP_CENTER, this.config.MAP_ZOOM);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap'
                }).addTo(this.state.map);
                this.getUserLocation();
            }
            
            initLocationPickerMap() {
                if (!this.state.locationPickerMap) {
                    this.state.locationPickerMap = L.map('locationMap').setView(this.config.MAP_CENTER, 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(this.state.locationPickerMap);
                    this.state.locationMarker = L.marker(this.config.MAP_CENTER, { draggable: true }).addTo(this.state.locationPickerMap);
                    this.state.locationMarker.on('dragend', (e) => {
                        const position = e.target.getLatLng();
                        this.state.selectedOrderLocation = {
                            lat: position.lat,
                            lng: position.lng,
                            address: `Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯: ${position.lat.toFixed(6)}, ${position.lng.toFixed(6)}`
                        };
                    });
                    this.state.locationPickerMap.on('click', (e) => {
                        this.state.locationMarker.setLatLng(e.latlng);
                        this.state.selectedOrderLocation = {
                            lat: e.latlng.lat,
                            lng: e.latlng.lng,
                            address: `Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯: ${e.latlng.lat.toFixed(6)}, ${e.latlng.lng.toFixed(6)}`
                        };
                    });
                }
                const initialLocation = this.state.currentPosition || { lat: this.config.MAP_CENTER[0], lng: this.config.MAP_CENTER[1] };
                this.state.locationPickerMap.setView([initialLocation.lat, initialLocation.lng], 13);
                this.state.locationMarker.setLatLng([initialLocation.lat, initialLocation.lng]);
                this.state.selectedOrderLocation = { ...initialLocation, address: `Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯: ${initialLocation.lat.toFixed(6)}, ${initialLocation.lng.toFixed(6)}` };
            }
            
            getUserLocation() {
                return new Promise((resolve) => {
                    if (!navigator.geolocation) {
                        this.updateLocationStatus('Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
                        resolve(false);
                        return;
                    }
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            this.state.currentPosition = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                address: 'Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ'
                            };
                            this.updateLocationStatus('Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø¬Ø§Ù‡Ø²');
                            resolve(true);
                        },
                        (error) => {
                            let message = 'ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                            if (error.code === error.PERMISSION_DENIED) message = 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†';
                            else if (error.code === error.POSITION_UNAVAILABLE) message = 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­';
                            else if (error.code === error.TIMEOUT) message = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©';
                            this.updateLocationStatus(message);
                            resolve(false);
                        }, { enableHighAccuracy: true, timeout: 10000 }
                    );
                });
            }
            
            updateLocationStatus(status) {
                const element = document.getElementById('locationStatus');
                if (element) {
                    const span = element.querySelector('span');
                    if (span) span.textContent = status;
                }
            }
            
            locateUser() {
                this.getUserLocation().then(success => {
                    if (success && this.state.map) {
                        this.state.map.setView([this.state.currentPosition.lat, this.state.currentPosition.lng], 13);
                        this.showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ', 'success');
                        this.updateDisplay();
                    } else {
                        this.showAlert('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙƒØŒ Ø­Ø§ÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹', 'warning');
                        this.showLocationPicker();
                    }
                });
            }
            
            showLocationPicker() {
                this.initLocationPickerMap();
                this.showModal('locationPickerModal');
            }
            
            confirmLocation() {
                if (!this.state.selectedOrderLocation) {
                    this.showAlert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹', 'error');
                    return;
                }
                document.getElementById('locationPickerModal').classList.remove('active');
                
                const locationInfo = document.getElementById('orderLocationInfo');
                if (locationInfo) {
                    locationInfo.innerHTML = `
                        <p><strong style="color: #28a745;">âœ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹:</strong> ${this.state.selectedOrderLocation.address}</p>
                        <button type="button" id="pickLocationBtn" class="btn-secondary">
                            <i class="fas fa-map-pin"></i> ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹
                        </button>
                    `;
                    document.getElementById('pickLocationBtn').addEventListener('click', () => this.showLocationPicker());
                }
                this.showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
            
            useCurrentLocationForPicker() {
                if (this.state.currentPosition) {
                    this.state.locationPickerMap.setView([this.state.currentPosition.lat, this.state.currentPosition.lng], 13);
                    this.state.locationMarker.setLatLng([this.state.currentPosition.lat, this.state.currentPosition.lng]);
                    this.state.selectedOrderLocation = this.state.currentPosition;
                    this.showAlert('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ', 'success');
                } else {
                    this.getUserLocation().then(success => {
                        if (success) {
                            this.state.locationPickerMap.setView([this.state.currentPosition.lat, this.state.currentPosition.lng], 13);
                            this.state.locationMarker.setLatLng([this.state.currentPosition.lat, this.state.currentPosition.lng]);
                            this.state.selectedOrderLocation = this.state.currentPosition;
                            this.showAlert('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ', 'success');
                        }
                    });
                }
            }
            
            showNewOrderModal() {
                if (!this.state.user) {
                    this.showAlert('ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    this.showSection('customer');
                    return;
                }
                this.state.selectedOrderLocation = null;
                const locationInfo = document.getElementById('orderLocationInfo');
                if (locationInfo) {
                    if (this.state.currentPosition) {
                        locationInfo.innerHTML = `
                            <p>Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ <span style="color: #6c757d;">(${this.state.currentPosition.address})</span></p>
                            <button type="button" id="pickLocationBtn" class="btn-secondary">
                                <i class="fas fa-map-pin"></i> ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹
                            </button>
                        `;
                        document.getElementById('pickLocationBtn').addEventListener('click', () => this.showLocationPicker());
                    } else {
                        locationInfo.innerHTML = `
                            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...</p>
                            <button type="button" id="pickLocationBtn" class="btn-secondary">
                                <i class="fas fa-map-pin"></i> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹
                            </button>
                        `;
                        this.getUserLocation().then(success => {
                            if (success) {
                                locationInfo.innerHTML = `
                                    <p>Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ <span style="color: #6c757d;">(${this.state.currentPosition.address})</span></p>
                                    <button type="button" id="pickLocationBtn" class="btn-secondary">
                                        <i class="fas fa-map-pin"></i> ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹
                                    </button>
                                `;
                                document.getElementById('pickLocationBtn').addEventListener('click', () => this.showLocationPicker());
                            }
                        });
                        document.getElementById('pickLocationBtn').addEventListener('click', () => this.showLocationPicker());
                    }
                }
                this.showModal('newOrderModal');
            }
            
            async createOrder(e) {
                e.preventDefault();
                if (!this.state.user) {
                    this.showAlert('ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    this.showSection('customer');
                    return;
                }

                if (!this.state.user.phone.startsWith('+963') || this.state.user.phone.length < 13) {
                    this.showAlert('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­ØŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†', 'error');
                    this.showSection('customer');
                    return;
                }

                const service = document.getElementById('orderService').value;
                const details = document.getElementById('orderDetails').value;
                if (!service || !details) {
                    this.showAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                    return;
                }
                
                let location;
                if (this.state.selectedOrderLocation) {
                    location = this.state.selectedOrderLocation;
                } else if (this.state.currentPosition) {
                    location = this.state.currentPosition;
                } else {
                    const { value: accept } = await Swal.fire({
                        title: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹',
                        text: 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹ØŸ',
                        icon: 'info',
                        showCancelButton: true,
                        confirmButtonText: 'ØªØ­Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹',
                        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
                    });
                    if (accept) {
                        this.showLocationPicker();
                        return;
                    } else {
                        return;
                    }
                }
                
                this.closeModals();
                this.showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...');
                
                const order = {
                    id: 'order_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    service,
                    details,
                    location,
                    phone: this.state.user.phone,
                    customerName: this.state.user.name,
                    userId: this.state.user.id,
                    timestamp: new Date().toISOString(),
                    status: 'new',
                    hidden: false
                };
                
                try {
                    this.state.orders.push(order);
                    this.state.newOrdersCheck.push(order.id);
                    this.saveToStorage('newOrdersCheck', this.state.newOrdersCheck);
                    this.addOrderToMap(order);
                    await this.saveOrdersToSheet();
                    await this.sendBotNotifications(order);
                    
                    this.hideLoading();
                    this.showAlert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    document.getElementById('newOrderForm').reset();
                    this.state.selectedOrderLocation = null;
                    this.updateDisplay();
                } catch (error) {
                    this.hideLoading();
                    Swal.fire({
                        title: 'ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„',
                        text: 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©ØŸ',
                        icon: 'error',
                        showCancelButton: true,
                        confirmButtonText: 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©',
                        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            this.showNewOrderModal();
                            document.getElementById('orderService').value = service;
                            document.getElementById('orderDetails').value = details;
                            this.state.selectedOrderLocation = location;
                        }
                    });
                }
            }
            
            addOrderToMap(order) {
                const marker = L.marker([order.location.lat, order.location.lng], {
                    icon: L.divIcon({
                        className: 'order-marker',
                        html: `<div style="background: ${this.getStatusColor(order.status)}; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; border: 3px solid white; box-shadow: 0 0 20px rgba(0,0,0,0.4);">
                                 <i class="${this.serviceIcons[order.service]}" style="font-size: 20px;"></i>
                               </div>`,
                        iconSize: [45, 45],
                        iconAnchor: [22.5, 22.5]
                    })
                }).addTo(this.state.map);
                marker.bindPopup(this.createPopup(order));
                marker.on('click', () => this.viewOrder(order.id));
                this.state.markers[order.id] = marker;
            }
            
            cleanOldOrders() {
                const now = Date.now();
                this.state.orders = this.state.orders.filter(order => {
                    const orderTime = new Date(order.timestamp).getTime();
                    const age = now - orderTime;
                    if ((order.status === 'completed' || order.status === 'cancelled') && age > 2 * 60 * 1000) return false;
                    if (order.status === 'new' && age > this.config.ORDER_TIMEOUT) return false;
                    if (order.status === 'taken') {
                        const takenAge = now - (order.takenAt || orderTime);
                        order.hidden = takenAge > this.config.TAKEN_TIMEOUT;
                    }
                    return true;
                });
            }
            
            updateMap() {
                Object.values(this.state.markers).forEach(m => m && m.remove());
                this.state.markers = {};
                const serviceFilter = document.getElementById('serviceFilter').value;
                this.state.lastFilter = serviceFilter;
                this.state.orders.forEach(order => {
                    if (!order.location || order.status === 'completed' || order.status === 'cancelled' || order.hidden) return;
                    if (serviceFilter === 'all' || order.service === serviceFilter) {
                        const marker = L.marker([order.location.lat, order.location.lng], {
                            icon: L.divIcon({
                                className: 'order-marker',
                                html: `<div style="background: ${this.getStatusColor(order.status)}; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; border: 3px solid white; box-shadow: 0 0 20px rgba(0,0,0,0.4);">
                                         <i class="${this.serviceIcons[order.service]}" style="font-size: 20px;"></i>
                                       </div>`,
                                iconSize: [45, 45],
                                iconAnchor: [22.5, 22.5]
                            })
                        }).addTo(this.state.map);
                        marker.bindPopup(this.createPopup(order));
                        marker.on('click', () => this.viewOrder(order.id));
                        this.state.markers[order.id] = marker;
                    }
                });
            }
            
            getStatusColor(status) {
                return { new: '#4361ee', taken: '#f8961e', completed: '#4cc9f0', cancelled: '#f94144' } [status] || '#4361ee';
            }
            
            createPopup(order) {
                const distance = this.state.currentPosition ?
                    this.calculateDistance(this.state.currentPosition.lat, this.state.currentPosition.lng, order.location.lat, order.location.lng).toFixed(1) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                return `
                    <div style="padding: 15px; max-width: 320px; font-size: 1rem;">
                        <h4 style="margin: 0 0 10px; color: #6a11cb; font-size: 1.3rem;"><i class="${this.serviceIcons[order.service]}"></i> ${this.serviceNames[order.service]}</h4>
                        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${this.getStatusText(order.status)}</p>
                        <p><strong>Ø§Ù„Ù…Ø³Ø§ÙØ©:</strong> ${distance} ÙƒÙ…</p>
                        <p><strong>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„:</strong> ${order.phone}</p>
                        <p><strong>Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong> ${order.details.substring(0, 60)}...</p>
                        <button onclick="app.viewOrder('${order.id}')" style="background: #6a11cb; color: white; border: none; padding: 10px 18px; border-radius: 10px; width: 100%; font-weight: bold; font-size: 1rem; cursor: pointer;">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                    </div>
                `;
            }
            
            updateNearbyOrders() {
                const container = document.getElementById('nearbyOrders');
                if (!container) return;
                if (!this.state.currentPosition) {
                    container.innerHTML = '<p style="text-align: center; font-size: 1.2rem;">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­</p>';
                    return;
                }
                const serviceFilter = document.getElementById('serviceFilter').value;
                let nearbyOrders = this.state.orders.filter(o => o.status === 'new' && !o.hidden && (serviceFilter === 'all' || o.service === serviceFilter) && o.location);
                nearbyOrders.forEach(o => o.distance = this.calculateDistance(this.state.currentPosition.lat, this.state.currentPosition.lng, o.location.lat, o.location.lng));
                nearbyOrders = nearbyOrders.filter(o => o.distance <= this.config.NEARBY_DISTANCE).sort((a, b) => a.distance - b.distance);
                if (nearbyOrders.length === 0) {
                    container.innerHTML = '<p style="text-align: center; font-size: 1.2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù‚Ø±ÙŠØ¨Ø© Ø¶Ù…Ù† 2 ÙƒÙ…</p>';
                    return;
                }
                container.innerHTML = nearbyOrders.map(order => `
                    <div class="order-item" data-id="${order.id}">
                        <div class="order-item-header">
                            <span class="order-item-service"><i class="${this.serviceIcons[order.service]}"></i> ${this.serviceNames[order.service]}</span>
                            <span class="order-item-status status-new">Ø¬Ø¯ÙŠØ¯</span>
                        </div>
                        <div class="order-item-details">${order.details.substring(0, 100)}...</div>
                        <div class="order-item-footer">
                            <span><i class="fas fa-map-marker-alt"></i> ${order.distance.toFixed(1)} ÙƒÙ…</span>
                            <div class="order-item-actions">
                                <button class="btn-secondary" onclick="app.viewOrder('${order.id}')"><i class="fas fa-eye"></i></button>
                                ${this.state.provider ? `<button class="btn-success" onclick="app.takeOrder('${order.id}')"><i class="fas fa-hand-paper"></i></button>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            updateSuggestedOrders() {
                const container = document.getElementById('suggestedOrders');
                if (!container) return;
                if (!this.state.currentPosition) {
                    container.innerHTML = '';
                    return;
                }
                const serviceFilter = document.getElementById('serviceFilter').value;
                let suggested = this.state.orders.filter(o => 
                    o.status === 'new' && !o.hidden && 
                    (serviceFilter !== 'all' ? o.service !== serviceFilter : true) && 
                    o.location
                );
                suggested.forEach(o => o.distance = this.calculateDistance(this.state.currentPosition.lat, this.state.currentPosition.lng, o.location.lat, o.location.lng));
                suggested = suggested.filter(o => o.distance <= this.config.NEARBY_DISTANCE).sort((a, b) => a.distance - b.distance).slice(0, 4);
                
                if (suggested.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #888; font-size: 1.2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª Ø£Ø®Ø±Ù‰ Ù‚Ø±ÙŠØ¨Ø© Ø¶Ù…Ù† 2 ÙƒÙ…</p>';
                    return;
                }
                container.innerHTML = suggested.map(order => `
                    <div class="order-item" data-id="${order.id}" style="border-right-color: #f39c12;">
                        <div class="order-item-header">
                            <span class="order-item-service"><i class="${this.serviceIcons[order.service]}"></i> ${this.serviceNames[order.service]}</span>
                            <span class="order-item-status status-new">Ø¬Ø¯ÙŠØ¯</span>
                        </div>
                        <div class="order-item-details">${order.details.substring(0, 80)}...</div>
                        <div class="order-item-footer">
                            <span><i class="fas fa-map-marker-alt"></i> ${order.distance.toFixed(1)} ÙƒÙ…</span>
                            <div class="order-item-actions">
                                <button class="btn-secondary" onclick="app.viewOrder('${order.id}')"><i class="fas fa-eye"></i></button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            async takeOrder(orderId) {
                if (!this.state.provider) {
                    this.showAlert('ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù‚Ø¯Ù… Ø§Ù„Ø®Ø¯Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    this.showSection('provider');
                    return;
                }
                const order = this.state.orders.find(o => o.id === orderId);
                if (!order || order.status !== 'new') {
                    this.showAlert('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ØªØ§Ø­', 'warning');
                    return;
                }
                order.status = 'taken';
                order.takenBy = this.state.provider.id;
                order.takenAt = Date.now();
                order.takenByName = this.state.provider.name;
                order.hidden = false;
                this.state.takenOrders.push(order);
                await this.saveOrdersToSheet();
                this.updateDisplay();
                this.showAlert('ØªÙ… Ø£Ø®Ø° Ø§Ù„Ø·Ù„Ø¨', 'success');
                this.sendWhatsAppNotification(order, 'taken');
            }
            
            async cancelOrder(orderId) {
                const order = this.state.orders.find(o => o.id === orderId);
                if (!order) return;
                if (order.status === 'taken' && order.takenBy === this.state.provider?.id) {
                    order.status = 'new';
                    order.takenBy = null;
                    order.takenAt = null;
                    order.takenByName = null;
                    order.hidden = false;
                    this.state.takenOrders = this.state.takenOrders.filter(o => o.id !== orderId);
                } else if (order.userId === this.state.user?.id) {
                    order.status = 'cancelled';
                }
                await this.saveOrdersToSheet();
                this.updateDisplay();
                this.showAlert('ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡', 'warning');
            }
            
            async completeOrder(orderId) {
                const order = this.state.orders.find(o => o.id === orderId);
                if (!order) return;
                order.status = 'completed';
                order.completedAt = Date.now();
                this.state.takenOrders = this.state.takenOrders.filter(o => o.id !== orderId);
                await this.saveOrdersToSheet();
                this.updateDisplay();
                this.showAlert('ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', 'success');
            }
            
            sendWhatsAppNotification(order, action) {
                if (!order.phone) return;
                if (action === 'taken' && order.takenByName) {
                    const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${order.customerName}ØŒ ${order.takenByName} Ù‚Ø§Ù… Ø¨Ø£Ø®Ø° Ø·Ù„Ø¨Ùƒ ÙˆØ³ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.`;
                    window.open(`https://wa.me/${order.phone}?text=${encodeURIComponent(msg)}`, '_blank');
                }
            }
            
            filterOrders(service) {
                this.updateMap();
                this.updateNearbyOrders();
                this.updateSuggestedOrders();
            }
            
            saveFilterPreference() {
                const filter = document.getElementById('serviceFilter').value;
                this.saveToStorage('filter', filter);
            }
            
            loadFilterPreference() {
                const saved = this.getFromStorage('filter') || 'all';
                document.getElementById('serviceFilter').value = saved;
                this.state.lastFilter = saved;
            }
            
            updateDisplay() {
                this.updateMap();
                this.updateNearbyOrders();
                this.updateSuggestedOrders();
                this.renderMyOrders();
                this.renderTakenOrders();
            }
            
            showUnakenOrdersOnMap() {
                const unaken = this.state.orders.filter(o => o.status === 'new' && o.location);
                if (unaken.length > 0) {
                    const totalLat = unaken.reduce((s, o) => s + o.location.lat, 0) / unaken.length;
                    const totalLng = unaken.reduce((s, o) => s + o.location.lng, 0) / unaken.length;
                    this.state.map.setView([totalLat, totalLng], 11);
                    this.showAlert(`ÙŠÙˆØ¬Ø¯ ${unaken.length} Ø·Ù„Ø¨ ØºÙŠØ± Ù…Ø£Ø®ÙˆØ°`, 'info');
                }
            }
            
            startAutoUpdate() {
                if (this.state.updateTimer) clearInterval(this.state.updateTimer);
                this.state.updateTimer = setInterval(async () => {
                    const currentOrders = [...this.state.orders];
                    await this.loadOrdersFromSheet();
                    if (!this.state.isFirstLoad && currentOrders.length > 0) {
                        this.checkForNewOrdersOnly(currentOrders);
                    }
                    this.updateAppStatus('Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ' + new Date().toLocaleTimeString('ar-SA'));
                }, this.config.UPDATE_INTERVAL);
            }
            
            checkForNewOrdersOnly(oldOrders) {
                if (!this.state.provider) return;
                const oldIds = new Set(oldOrders.map(o => o.id));
                const oldNewIds = new Set(oldOrders.filter(o => o.status === 'new').map(o => o.id));
                const newOrders = this.state.orders.filter(o => o.status === 'new' && !oldIds.has(o.id));
                const reactivated = this.state.orders.filter(o => o.status === 'new' && oldIds.has(o.id) && !oldNewIds.has(o.id) && !this.state.newOrdersCheck.includes(o.id));
                [...newOrders, ...reactivated].forEach(order => {
                    this.sendBotNotifications(order);
                    if (!this.state.newOrdersCheck.includes(order.id)) {
                        this.state.newOrdersCheck.push(order.id);
                    }
                });
                if (newOrders.length || reactivated.length) {
                    this.showAlert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${newOrders.length + reactivated.length} Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯`, 'success');
                    this.saveToStorage('newOrdersCheck', this.state.newOrdersCheck);
                }
            }
            
            showSection(section) {
                document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(section + 'Section').classList.add('active');
                document.getElementById(section + 'Btn').classList.add('active');
                if (section === 'home') {
                    setTimeout(() => this.state.map?.invalidateSize(), 100);
                    this.updateDisplay();
                } else if (section === 'customer') {
                    this.renderMyOrders();
                } else if (section === 'provider') {
                    this.renderTakenOrders();
                    this.displayProviderChannels();
                } else if (section === 'admin') {
                    if (this.state.adminLoggedIn) {
                        document.getElementById('adminLogin').style.display = 'none';
                        document.getElementById('adminContent').style.display = 'block';
                        this.displayAdminChannels();
                    } else {
                        document.getElementById('adminLogin').style.display = 'block';
                        document.getElementById('adminContent').style.display = 'none';
                        document.getElementById('adminPassword').value = '';
                    }
                }
            }
            
            showModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            }
            
            closeModals() {
                document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
            }
            
            showAlert(message, type = 'info') {
                Swal.fire({ title: message, icon: type, timer: 3000, toast: true, position: 'top-end', showConfirmButton: false });
            }
            
            viewOrder(orderId) {
                const order = this.state.orders.find(o => o.id === orderId);
                if (!order) return;
                const content = document.getElementById('orderDetailsContent');
                content.innerHTML = `
                    <div style="padding: 15px;">
                        <h4 style="color: #6a11cb; font-size: 1.5rem;"><i class="${this.serviceIcons[order.service]}"></i> ${this.serviceNames[order.service]}</h4>
                        <p><strong>Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong> ${order.details}</p>
                        <p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${order.location.address}</p>
                        <p><strong>Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> ${order.customerName} - <a href="https://wa.me/${order.phone}" target="_blank">${order.phone}</a></p>
                        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${this.getStatusText(order.status)}</p>
                        <div style="display: flex; gap: 15px; margin-top: 25px;">
                            ${order.status === 'new' && this.state.provider ? `<button onclick="app.takeOrder('${order.id}')" class="btn-primary">Ø£Ø®Ø° Ø§Ù„Ø·Ù„Ø¨</button>` : ''}
                            ${(order.status === 'taken' && order.takenBy === this.state.provider?.id) ? `<button onclick="app.completeOrder('${order.id}')" class="btn-success">Ø¥ÙƒÙ…Ø§Ù„</button><button onclick="app.cancelOrder('${order.id}')" class="btn-danger">Ø¥Ù„ØºØ§Ø¡</button>` : ''}
                            ${order.userId === this.state.user?.id && order.status === 'new' ? `<button onclick="app.cancelOrder('${order.id}')" class="btn-danger">Ø¥Ù„ØºØ§Ø¡</button>` : ''}
                        </div>
                    </div>
                `;
                this.showModal('orderDetailsModal');
            }
            
            async saveCustomer(e) {
                e.preventDefault();
                const name = document.getElementById('customerName').value;
                const phone = document.getElementById('customerPhone').value;
                if (!name || !phone) {
                    this.showAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                    return;
                }
                if (!phone.startsWith('+963') || phone.length < 13) {
                    this.showAlert('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ +963 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 13 Ø±Ù‚Ù… (Ù…Ø«Ø§Ù„: +963912345678)', 'error');
                    return;
                }
                this.state.user = { id: 'user_' + Date.now(), name, phone, createdAt: new Date().toISOString() };
                this.saveToStorage('user', this.state.user);
                this.showAlert('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†', 'success');
                this.renderMyOrders();
            }
            
            async saveProvider(e) {
                e.preventDefault();
                const name = document.getElementById('providerName').value;
                const services = [];
                document.querySelectorAll('input[name="services"]:checked').forEach(cb => services.push(cb.value));
                if (!name || services.length === 0) {
                    this.showAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                    return;
                }
                
                this.state.provider = {
                    id: 'provider_' + Date.now(),
                    name,
                    services,
                    createdAt: new Date().toISOString()
                };
                this.saveToStorage('provider', this.state.provider);
                
                this.resetNewOrdersCheck();
                this.showAlert('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù‚Ø¯Ù… Ø§Ù„Ø®Ø¯Ù…Ø©', 'success');
                this.renderTakenOrders();
                this.displayProviderChannels();
            }
            
            renderMyOrders() {
                const container = document.getElementById('myOrdersList');
                if (!container) return;
                const myOrders = this.state.orders.filter(o => o.userId === this.state.user?.id).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                if (myOrders.length === 0) {
                    container.innerHTML = '<p style="text-align: center; font-size: 1.2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>';
                    return;
                }
                container.innerHTML = myOrders.map(order => `
                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 18px; margin-bottom: 1.5rem; border-right: 8px solid ${this.getStatusColor(order.status)}; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <strong style="font-size: 1.3rem;"><i class="${this.serviceIcons[order.service]}"></i> ${this.serviceNames[order.service]}</strong>
                            <span style="background: ${this.getStatusColor(order.status)}20; color: ${this.getStatusColor(order.status)}; padding: 0.5rem 1.5rem; border-radius: 40px; font-size: 1rem; font-weight: 700;">${this.getStatusText(order.status)}</span>
                        </div>
                        <p style="color: #555; margin-bottom: 0.8rem; font-size: 1.1rem;">${order.details.substring(0, 100)}...</p>
                        <small style="color: #888; font-size: 1rem;">${new Date(order.timestamp).toLocaleString('ar-SA')}</small>
                    </div>
                `).join('');
            }
            
            renderTakenOrders() {
                const container = document.getElementById('takenOrdersList');
                if (!container) return;
                if (this.state.takenOrders.length === 0) {
                    container.innerHTML = '<p style="text-align: center; font-size: 1.2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø£Ø®ÙˆØ°Ø©</p>';
                    return;
                }
                container.innerHTML = this.state.takenOrders.map(order => `
                    <div style="background: #fff3e0; padding: 1.5rem; border-radius: 18px; margin-bottom: 1.5rem; border-right: 8px solid #f8961e; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <strong style="font-size: 1.3rem;"><i class="${this.serviceIcons[order.service]}"></i> ${this.serviceNames[order.service]}</strong>
                        <p style="color: #555; margin: 1rem 0; font-size: 1.1rem;">${order.details.substring(0, 100)}...</p>
                        <p style="font-size: 1.1rem;">Ø§Ù„Ø²Ø¨ÙˆÙ†: <a href="https://wa.me/${order.phone}" target="_blank">${order.phone}</a></p>
                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button onclick="app.completeOrder('${order.id}')" class="btn-success">Ø¥ÙƒÙ…Ø§Ù„</button>
                            <button onclick="app.cancelOrder('${order.id}')" class="btn-danger">Ø¥Ù„ØºØ§Ø¡</button>
                        </div>
                    </div>
                `).join('');
            }
            
            resetNewOrdersCheck() {
                this.state.newOrdersCheck = this.state.orders.filter(o => o.status === 'new').map(o => o.id);
                this.saveToStorage('newOrdersCheck', this.state.newOrdersCheck);
            }
            
            calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371;
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) ** 2;
                return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            }
            
            getStatusText(status) {
                return { new: 'Ø¬Ø¯ÙŠØ¯', taken: 'Ù…Ø£Ø®ÙˆØ°', completed: 'Ù…ÙƒØªÙ…Ù„', cancelled: 'Ù…Ù„ØºÙ‰' } [status] || status;
            }
            
            loadUserData() {
                this.state.user = this.getFromStorage('user');
                this.state.provider = this.getFromStorage('provider');
                this.state.orders = this.getFromStorage('orders') || [];
                this.state.takenOrders = this.getFromStorage('takenOrders') || [];
                this.state.newOrdersCheck = this.getFromStorage('newOrdersCheck') || [];
                
                if (this.state.user) {
                    document.getElementById('customerName').value = this.state.user.name || '';
                    document.getElementById('customerPhone').value = this.state.user.phone || '';
                }
                if (this.state.provider) {
                    document.getElementById('providerName').value = this.state.provider.name || '';
                    document.querySelectorAll('input[name="services"]').forEach(cb => {
                        cb.checked = this.state.provider.services?.includes(cb.value) || false;
                    });
                }
            }
            
            getFromStorage(key) {
                try { return JSON.parse(localStorage.getItem(`talabat_${key}`)); } catch { return null; }
            }
            
            saveToStorage(key, data) {
                localStorage.setItem(`talabat_${key}`, JSON.stringify(data));
            }
            
            updateAppStatus(status) {
                document.getElementById('appStatus').textContent = 'Ø§Ù„Ø­Ø§Ù„Ø©: ' + status;
            }
        }
        
        let app;
        window.addEventListener('DOMContentLoaded', () => {
            app = new TalabatApp();
            window.app = app;
        });
    </script>
    <!-- Ù…Ø­ØªÙˆÙ‰ sw.js Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙƒÙ…Ù„Ù Ù…Ù†ÙØµÙ„ØŒ ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ† ÙˆØ¶Ø¹Ù‡ Ù‡Ù†Ø§ Ù„Ù„ØªÙƒØ§Ù…Ù„ -->
    <script>
        // Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙŠÙ…Ø«Ù„ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù sw.js - ÙŠØ¬Ø¨ Ø­ÙØ¸Ù‡ ÙƒÙ…Ù„Ù Ù…Ù†ÙØµÙ„ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù…
        // Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù€ sw.js:
        /*
        const CACHE_NAME = 'talabat-cache-v1';
        const urlsToCache = [
            '.',
            'index.html',
            'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css',
            'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css',
            'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js',
            'https://cdn.jsdelivr.net/npm/sweetalert2@11'
        ];

        self.addEventListener('install', event => {
            event.waitUntil(
                caches.open(CACHE_NAME)
                    .then(cache => cache.addAll(urlsToCache))
            );
        });

        self.addEventListener('fetch', event => {
            event.respondWith(
                caches.match(event.request)
                    .then(response => response || fetch(event.request))
            );
        });

        self.addEventListener('activate', event => {
            event.waitUntil(
                caches.keys().then(cacheNames => {
                    return Promise.all(
                        cacheNames.filter(name => name !== CACHE_NAME)
                            .map(name => caches.delete(name))
                    );
                })
            );
        });
        */
    </script>
    
    <script src="sw.js" type="text/javascript" charset="utf-8"></script>
</body>
</html>